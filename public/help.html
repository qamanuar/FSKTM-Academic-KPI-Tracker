<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Help & Support</title>

  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href = "/css/sidebar.css" rel="stylesheet">

<style>
    :root {
  --bs-primary: #6f42c1;
  --bs-primary-dark: #5a32a3;
  --bs-light-bg: #f4f0fa;
}

body {
  /* font-family: 'Poppins', sans-serif; */
  background-color: var(--bs-light-bg);
  margin: 0;
}

.main-content {
  margin-left: 90px;
  padding: 2rem;
  flex-grow: 1;
  padding-top: 90px; /* ← Push content below the fixed header */
  font-family: 'Poppins';
  position: relative;
  width: calc(100% - 78px);
  left: 50px;
  justify-content: center;
  flex: 1 0 auto;
}


  header {
    background-color: rgb(222, 204, 255);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    padding: 1rem;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    text-align: center;
    justify-content: center;
    z-index: 1001;
    height: 70px;
  }

  .header-container{
    display: flex;
    justify-content: space-between;
  }

  header ul{
    justify-content: space-between;
    display: flex;
    gap: 10rem;
  }

body, html {
  height: 100%;
  margin: 0;
  display: flex;
  flex-direction: column;
}

/* Only fix the arrow conflict from Tailwind's preflight */
.accordion-button::after {
  background-image: none !important;
}

</style>

</head>
<body class="min-h-screen flex flex-col">
<header class="items-center flex justify-content-between">
    <img src="./assets/images/fsktm-kpi-logo.png" alt="Logo" style="height: 60px; margin-left:30px">  
    <div>
      <ul class="flex gap-lg-5">
        <li id="username" class="text-lg justify-center text-[#2e067d] mt-1 font-medium"></li>
        <li class="mt-1">
          <a href="/General.html" class="text-lg text-[#2e067d] border-2 border-[#2e067d] py-1 px-3 rounded-lg 
            hover:bg-[#2e067d] hover:text-white transition duration-200">
            Logout
          </a>
        </li>
      </ul>
    </div>
  </header>

  <div class="flex flex-1">
  <!-- Side Navigation Bar -->
  <div class = "sidebar">
    <div class = "logo_content">
      <div class="logo">
          <i class='bx bxs-bar-chart-alt-2'></i>
          <div class="logo_name">FSKTM KPI Tracker</div>
        </div>
      <i class='bx bx-menu' id = "btn" >
        <span class = "tooltip">Menu</span>
      </i>
      <ul class="nav_list">
        <li>
          <a href = "profile.html">
            <i class='bx bx-user'></i>
            <span class="links_name">My Account</span>
          </a>
          <span class="tooltip">My Account</span>
        </li>
        <li>
          <a href="LecturerDashboard.html">
            <i class='bx bxs-dashboard'></i>
            <span class="links_name">Lecturer Dashboard</span>
          </a>
          <span class="tooltip">KPI Dashboard</span>
          
          <!--Revisit-->
          <!-- Submenu starts here -->
          <!-- <ul class="submenu">
            <li><a href="#">KPI Overview</a></li>
            <li><a href="#">KPI Management</a></li>
            <li><a href="#">KPI Verification</a></li>
          </ul>
        </li> -->

        <li>
          <a href = "Student_Dash.html">
            <i class='bx bxs-dashboard' ></i>
            <span class="links_name">Student Dashboard</span>
          </a>
          <span class="tooltip">KPI Dashboard</span>
        </li>
        <li>
          <a href = "notification.html">
            <i class='bx bxs-bell'></i>
            <span class="links_name">Notifications</span>
          </a>
          <span class="tooltip">Notifications</span>
        </li>
        <li>
          <a href = "help.html">
            <i class='bx bx-question-mark'></i>
            <span class="links_name">Help & Support</span>
          </a>
          <span class="tooltip">Help & Support</span>
        </li>
      </ul>
    </div>
  </div>

     <main class="flex-1 p-4 bg-gray-100 mainPage">
      <div class="main-content">
        <h2 class="mb-4 fw-bold fs-2">Help & Support</h2>

<!-- FAQ Section -->
<div class="mb-5">
  <h4 class="text-xl font-semibold mb-5 text-gray-800">Frequently Asked Questions</h4>

  <!-- FAQ Item -->
  <div class="faq-item border border-gray-200 rounded-lg overflow-hidden mb-3 bg-white shadow">
    <button type="button"
      class="faq-toggle w-full px-4 py-3 flex justify-between items-center text-left hover:bg-gray-50 transition">
      <span class="text-base font-medium text-gray-800">How do I reset my password?</span>
      <svg class="w-4 h-4 transition-transform duration-200 transform rotate-0 text-gray-600"
        fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M19 9l-7 7-7-7" />
      </svg>
    </button>
    <div class="faq-content hidden px-4 pb-3 text-gray-600 text-sm bg-gray-50">
      Go to <span class="font-semibold text-gray-800">Account Settings</span> &gt;
      <span class="font-semibold text-gray-800">Reset Password</span>.
    </div>
  </div>

  <!-- FAQ Item 2 -->
  <div class="faq-item border border-gray-200 rounded-lg overflow-hidden mb-3 bg-white shadow">
    <button type="button"
      class="faq-toggle w-full px-4 py-3 flex justify-between items-center text-left hover:bg-gray-50 transition">
      <span class="text-base font-medium text-gray-800">Can I change my email address?</span>
      <svg class="w-4 h-4 transition-transform duration-200 transform rotate-0 text-gray-600"
        fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M19 9l-7 7-7-7" />
      </svg>
    </button>
    <div class="faq-content hidden px-4 pb-3 text-gray-600 text-sm bg-gray-50">
      Yes, go to <span class="font-semibold text-gray-800">Account Settings</span> and select
      <span class="font-semibold text-gray-800">Change Email</span>.
    </div>
  </div>

  <!-- FAQ Item 3 -->
  <div class="faq-item border border-gray-200 rounded-lg overflow-hidden mb-3 bg-white shadow">
    <button type="button"
      class="faq-toggle w-full px-4 py-3 flex justify-between items-center text-left hover:bg-gray-50 transition">
      <span class="text-base font-medium text-gray-800">Who can see my performance data?</span>
      <svg class="w-4 h-4 transition-transform duration-200 transform rotate-0 text-gray-600"
        fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M19 9l-7 7-7-7" />
      </svg>
    </button>
    <div class="faq-content hidden px-4 pb-3 text-gray-600 text-sm bg-gray-50">
      Your performance data is only visible to you and authorized academic staff such as your advisor or 
      course coordinator. This ensures your information is secure and used only to support your academic 
      development.
    </div>
  </div>
</div>

      <!-- Ticket Support Form -->
      <div class="mt-8"></div>
      <h2 class="text-xl font-semibold mb-2">Submit a Help or Support Ticket</h2>      <form id="ticketForm" class="card p-4 mb-4">
        <div class="mb-3">
          <label for="issueTitle" class="form-label">Issue Title</label>
          <input type="text" id="issueTitle" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="issueDescription" class="form-label">Description</label>
          <textarea id="issueDescription" rows="4" class="form-control" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit Ticket</button>
      </form>

      <!-- Ticket Confirmation -->
      <div id="ticketResponse" class="alert alert-success d-none">
        Ticket submitted successfully! Ticket ID: <span id="ticketId"></span>
      </div>

    <!-- Ticket History -->
    <h5>View Ticket History</h5>
    <div class="mb-3">
      <button class="btn btn-outline-primary" onclick="filterTickets('in-progress')">In Progress</button>
      <button class="btn btn-outline-warning" onclick="filterTickets('past')">Past</button>
      <button class="btn btn-outline-success" onclick="filterTickets('completed')">Completed</button>
    </div>
    <ul id="ticketHistory" class="list-group"></ul>
  </div>
</div>

 </main>
  </div>

<footer class="h-50 bg-[#2C0057] ml-[78px] flex items-center justify-between">
      <img src="./assets/images/fsktm-kpi-logo-white.png" alt="KPI-Logo" class="w-1/4 h-[210px] ">

      <div>
        <ul class="text-white text-start">
          <h2 class="text-xl font-semibold mb-1">Contact Us</h2>
          <li class="mb-1/2">kpi-admin@fsktm.um.edu.my</li>
          <li class="mb-1/2">company address</li>
          <li>+60 12 - 768 4400</li>
        </ul>
      </div>

      <p class="text-white text-sm mr-10">COPYRIGHT 2025 © FSKTM KPI Tracker</p>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const feedbackForm = document.getElementById("feedbackForm");
  const feedbackResponse = document.getElementById("feedbackResponse");
  const feedbackList = document.getElementById("feedbackList");
  const modalContent = document.getElementById("modalContent");
  const deleteBtn = document.getElementById("deleteBtn");
  let currentFeedbackId = null;

  // Load all feedback on page load
  document.addEventListener("DOMContentLoaded", fetchFeedbacks);

  feedbackForm.addEventListener("submit", async function (e) {
    e.preventDefault();

    const feedback = {
      user: document.getElementById("user").value,
      email: document.getElementById("email").value,
      message: document.getElementById("message").value
    };

    try {
      const res = await fetch("/api/help/feedback", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(feedback)
      });

      if (res.ok) {
        feedbackForm.reset();
        feedbackResponse.classList.remove("d-none");
        fetchFeedbacks(); // refresh list
      } else {
        alert("Something went wrong.");
      }
    } catch (error) {
      console.error("Submission error:", error);
    }
  });

  async function fetchFeedbacks() {
    feedbackList.innerHTML = "";
    const res = await fetch("/api/help/feedback");
    const feedbacks = await res.json();

    feedbacks.forEach(fb => {
      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-center";
      li.innerHTML = `
        <span>
          <strong>${fb.user}</strong>: ${fb.message.substring(0, 30)}...
        </span>
        <button class="btn btn-sm btn-outline-info" onclick="viewFeedback('${fb._id}')">View</button>
      `;
      feedbackList.appendChild(li);
    });
  }

  // View specific feedback
  async function viewFeedback(id) {
    const res = await fetch(`/api/help/feedback/${id}`);
    const fb = await res.json();
    currentFeedbackId = id;

    modalContent.innerHTML = `
      <p><strong>User:</strong> ${fb.user}</p>
      <p><strong>Email:</strong> ${fb.email}</p>
      <p><strong>Message:</strong><br>${fb.message}</p>
      <p><strong>Submitted At:</strong> ${new Date(fb.createdAt).toLocaleString()}</p>
    `;

    const modal = new bootstrap.Modal(document.getElementById('feedbackModal'));
    modal.show();
  }

  // Delete feedback
  deleteBtn.addEventListener("click", async () => {
    if (!currentFeedbackId) return;

    const confirmDelete = confirm("Are you sure you want to delete this feedback?");
    if (!confirmDelete) return;

    const res = await fetch(`/api/help/feedback/${currentFeedbackId}`, {
      method: "DELETE"
    });

    if (res.ok) {
      const modal = bootstrap.Modal.getInstance(document.getElementById('feedbackModal'));
      modal.hide();
      fetchFeedbacks();
      alert("Feedback deleted.");
    } else {
      alert("Failed to delete feedback.");
    }
  });
</script>
<script src = "/js/sidebar_script.js"></script>
<script>
  document.querySelectorAll(".faq-toggle").forEach(button => {
    button.addEventListener("click", () => {
      const content = button.nextElementSibling;
      const icon = button.querySelector("svg");

      content.classList.toggle("hidden");
      icon.classList.toggle("rotate-180");
    });
  });
</script>
<script>
      window.addEventListener("DOMContentLoaded", async () => {
        const session = JSON.parse(localStorage.getItem("userSession"));
        if (!session || !session.id) {
          alert("No user session found. Please log in.");
          window.location.href = "General.html";
          return;
        }

        try {
          const res = await fetch(`http://localhost:3000/api/students/${session.id}`);
          const data = await res.json();

          if (res.ok && data.user) {
            // ✅ Update the header name to match profile.html
            document.getElementById("username").textContent = data.user.name;
          } else {
            throw new Error(data.message || "User not found");
          }
        } catch (err) {
          console.error(err);
          alert("Failed to load user info.");
        }
      });
    </script>

</body>
</html>
